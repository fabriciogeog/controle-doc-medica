<!DOCTYPE html>
<html>
<head>
    <title>Debug - Bot√£o Editar Modal</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .success { background: #d4edda; }
        .error { background: #f8d7da; }
        button { padding: 10px 15px; margin: 5px; }
        pre { background: #f8f9fa; padding: 10px; overflow-x: auto; font-size: 12px; }
        .logs { max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>üîç Debug - Bot√£o Editar no Modal de Visualiza√ß√£o</h1>
    
    <div class="test">
        <h3>Passo 1: Fazer Login</h3>
        <button onclick="fazerLogin()">üîë Login</button>
        <div id="loginResult"></div>
    </div>
    
    <div class="test">
        <h3>Passo 2: Simular Abertura de Visualiza√ß√£o</h3>
        <button onclick="simularVisualizacao()">üëÅÔ∏è Simular Visualiza√ß√£o</button>
        <div id="visualResult"></div>
    </div>
    
    <div class="test">
        <h3>Passo 3: Testar Fun√ß√£o abrirEdicaoDoModal</h3>
        <button onclick="testarBotaoEditar()">‚úèÔ∏è Testar Editar</button>
        <div id="editResult"></div>
    </div>
    
    <div class="test">
        <h3>Passo 4: Verificar Estado da Aplica√ß√£o</h3>
        <button onclick="verificarEstado()">üîç Verificar Estado</button>
        <div id="stateResult"></div>
    </div>
    
    <div class="test">
        <h3>üìù Console Logs</h3>
        <div id="consoleLogs" class="logs"></div>
        <button onclick="limparLogs()">üßπ Limpar Logs</button>
    </div>

    <script>
        // Interceptar console.log para mostrar na p√°gina
        const originalLog = console.log;
        const originalError = console.error;
        const logs = [];
        
        function addLog(type, message) {
            const timestamp = new Date().toLocaleTimeString();
            logs.push(`[${timestamp}] ${type}: ${message}`);
            updateLogDisplay();
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addLog('LOG', args.join(' '));
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addLog('ERROR', args.join(' '));
        };
        
        function updateLogDisplay() {
            document.getElementById('consoleLogs').innerHTML = 
                '<pre>' + logs.slice(-20).join('\n') + '</pre>';
        }
        
        function limparLogs() {
            logs.length = 0;
            updateLogDisplay();
        }
        
        async function fazerLogin() {
            const result = document.getElementById('loginResult');
            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ senha: 'DocMed2025' })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    result.innerHTML = '<div class="success">‚úÖ Login OK</div>';
                    console.log('Login realizado com sucesso');
                } else {
                    result.innerHTML = `<div class="error">‚ùå Login falhou: ${data.message}</div>`;
                }
            } catch (error) {
                result.innerHTML = `<div class="error">‚ùå Erro: ${error.message}</div>`;
                console.error('Erro no login:', error);
            }
        }
        
        async function simularVisualizacao() {
            const result = document.getElementById('visualResult');
            const documentoId = '68c49b8577eae003318ff3d7';
            
            try {
                console.log('Simulando abertura de visualiza√ß√£o...');
                
                // Verificar se app existe
                if (typeof app === 'undefined') {
                    result.innerHTML = '<div class="error">‚ùå Objeto app n√£o encontrado. Carregue a p√°gina principal primeiro.</div>';
                    return;
                }
                
                // Simular a chamada de visualiza√ß√£o
                await app.abrirVisualizacao(documentoId);
                
                result.innerHTML = '<div class="success">‚úÖ Visualiza√ß√£o simulada</div>';
                console.log('Visualiza√ß√£o executada');
                
            } catch (error) {
                result.innerHTML = `<div class="error">‚ùå Erro: ${error.message}</div>`;
                console.error('Erro na visualiza√ß√£o:', error);
            }
        }
        
        function testarBotaoEditar() {
            const result = document.getElementById('editResult');
            
            try {
                console.log('Testando bot√£o Editar...');
                
                // Verificar se app existe
                if (typeof app === 'undefined') {
                    result.innerHTML = '<div class="error">‚ùå Objeto app n√£o encontrado</div>';
                    return;
                }
                
                // Verificar se a fun√ß√£o existe
                if (typeof app.abrirEdicaoDoModal !== 'function') {
                    result.innerHTML = '<div class="error">‚ùå Fun√ß√£o abrirEdicaoDoModal n√£o encontrada</div>';
                    return;
                }
                
                // Verificar currentViewDocument
                console.log('app.currentViewDocument:', app.currentViewDocument);
                
                // Tentar executar a fun√ß√£o
                app.abrirEdicaoDoModal();
                
                result.innerHTML = '<div class="success">‚úÖ Fun√ß√£o chamada</div>';
                
            } catch (error) {
                result.innerHTML = `<div class="error">‚ùå Erro: ${error.message}</div>`;
                console.error('Erro ao testar bot√£o:', error);
            }
        }
        
        function verificarEstado() {
            const result = document.getElementById('stateResult');
            
            try {
                console.log('Verificando estado da aplica√ß√£o...');
                
                let info = '<h4>Estado da Aplica√ß√£o:</h4>';
                
                if (typeof app === 'undefined') {
                    info += '‚ùå app: undefined<br>';
                } else {
                    info += '‚úÖ app: existe<br>';
                    info += `üìÑ currentViewDocument: ${app.currentViewDocument ? 'existe' : 'null'}<br>`;
                    
                    if (app.currentViewDocument) {
                        info += `üÜî ID: ${app.currentViewDocument._id}<br>`;
                        info += `üìã Tipo: ${app.currentViewDocument.tipoDocumento}<br>`;
                    }
                    
                    info += `‚öôÔ∏è abrirEdicaoDoModal: ${typeof app.abrirEdicaoDoModal}<br>`;
                    info += `‚öôÔ∏è editarDocumento: ${typeof app.editarDocumento}<br>`;
                }
                
                // Verificar se modal de visualiza√ß√£o est√° aberto
                const viewModal = document.getElementById('viewModal');
                if (viewModal) {
                    info += `üëÅÔ∏è Modal visualiza√ß√£o: ${viewModal.classList.contains('show') ? 'aberto' : 'fechado'}<br>`;
                } else {
                    info += '‚ùå Modal visualiza√ß√£o: n√£o encontrado<br>';
                }
                
                result.innerHTML = info;
                
            } catch (error) {
                result.innerHTML = `<div class="error">‚ùå Erro: ${error.message}</div>`;
                console.error('Erro ao verificar estado:', error);
            }
        }
        
        // Aguardar o carregamento da p√°gina
        setTimeout(() => {
            console.log('P√°gina de debug carregada');
            verificarEstado();
        }, 1000);
    </script>
    
    <script src="js/app.js"></script>
</body>
</html>
